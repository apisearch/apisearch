machine:
  pre:
    - curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0
  services:
    - docker
  environment:
    GOPATH: /home/ubuntu/.go_workspace
    IMPORT_PATH: github.com/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME
    CGO_ENABLED: 0
    GOOS: linux

dependencies:
  pre:
    - go get -t -d -v ./...
  override:
    - go build -a -installsuffix cgo -o apisearch .
    - docker build -t apisearch/apisearch .

test:
  override:
    - docker run --rm apisearch/apisearch
